# Babylon Entity Reference
# All game entities and their relationships

meta:
  version: "2.0.0"
  updated: "2025-12-26"
  total_entity_types: 17
  schema_location: "src/babylon/schemas/entities/"
  data_location: "src/babylon/data/game/"
  epoch_compatibility: "1 → 2 Bridge"
  status: "APPROVED_ARCHITECTURE"

# =============================================================================
# EPOCH 2 BRIDGE: EXTENSIBILITY SYSTEM
# =============================================================================
# Adds tags and flags to BaseEntity for Epoch 2 properties without schema migration

extensibility_system:
  name: "Entity Tags and Flags"
  status: "APPROVED_ARCHITECTURE"
  created: "2025-12-26"

  rationale: |
    Epoch 2 introduces many new entity properties:
    - security_rating, reactionary_latency (Panopticon - Slice 2.9)
    - entitlement, chauvinism (Reactionary Subject - Slice 2.3)
    - mass_receptivity, intel_confidence (Epistemic Horizon - Slice 2.10)
    - cadre_discipline, volatility (multiple systems)

    Rather than constant Pydantic schema migrations (breaking changes),
    we add EXTENSIBLE CONTAINERS to the base entity model:
    - tags: Dict[str, Any] - arbitrary key-value pairs
    - flags: Set[str] - boolean markers

    This allows Epoch 2 systems to attach properties without modifying
    the core Epoch 1 schema. The Debug UI displays these in a raw JSON
    viewer for inspection.

  base_entity_extension:
    fields:
      tags:
        type: "Dict[str, Any]"
        default: "{}"
        purpose: "Arbitrary key-value pairs for Epoch 2 properties"
        serialization: "JSON-serializable values only"
        examples:
          - 'tags["security_rating"] = 0.7'
          - 'tags["reactionary_latency"] = 5'
          - 'tags["entitlement"] = 0.8'
          - 'tags["chauvinism"] = 0.3'
          - 'tags["mass_receptivity"] = 0.6'
          - 'tags["intel_confidence"] = 0.4'
          - 'tags["cadre_discipline"] = 0.8'
          - 'tags["volatility"] = 0.5'

      flags:
        type: "Set[str]"
        default: "set()"
        purpose: "Boolean markers for quick checks"
        examples:
          - 'flags.add("MASKED")  # This entity shows false data in shadow state'
          - 'flags.add("HOSTILE")  # Territory is hostile to player'
          - 'flags.add("BASE_AREA")  # Territory is a revolutionary base'
          - 'flags.add("UNDER_SURVEILLANCE")  # State is watching this entity'
          - 'flags.add("DEFECTION_RISK")  # C_la unit may defect to fascism'
          - 'flags.add("CONTACT_NETWORK")  # Territory has intel infrastructure'

  known_epoch_2_tags:
    panopticon:
      slice: "2.9"
      tags:
        security_rating: "State attention level (0.0-1.0)"
        threat_classification: "State's threat assessment"
        surveillance_threads: "Number of State attention threads allocated"
      flags:
        - "UNDER_SURVEILLANCE"
        - "HIGH_PRIORITY_TARGET"
        - "INFILTRATED"

    reactionary_subject:
      slice: "2.3"
      tags:
        entitlement: "Investment in status quo (0.0-1.0)"
        chauvinism: "Accumulated chauvinism debuff (0.0-1.0)"
        fascist_alignment: "Progress toward fascist faction (0.0-1.0)"
      flags:
        - "DEFECTION_RISK"
        - "FASCIST_DRIFT"
        - "LABOR_ARISTOCRACY"

    epistemic_horizon:
      slice: "2.10"
      tags:
        mass_receptivity: "Willingness to share intel (0.0-1.0)"
        intel_confidence: "Accuracy of player's knowledge (0.0-1.0)"
        intel_decay_rate: "How fast intel becomes stale"
        last_intel_update: "Tick when intel was last refreshed"
      flags:
        - "MASKED"
        - "APPROXIMATE"
        - "STALE"
        - "CONTACT_NETWORK"
        - "BASE_AREA"
        - "HOSTILE"

    kinetic_warfare:
      slice: "2.7"
      tags:
        combat_readiness: "Unit's combat effectiveness"
        operational_security: "Resistance to detection"
        blowback_accumulated: "Collateral damage consequences"
      flags:
        - "GUERILLA_CAPABLE"
        - "URBAN_GUERILLA"
        - "COMPROMISED"

    resource_economy:
      slice: "2.6"
      tags:
        cadre_discipline: "Quality of Cadre leadership (0.0-1.0)"
        sympathizer_count: "Number of Sympathizers"
        reputation_local: "Local reputation modifier"
      flags:
        - "CADRE_PRESENT"
        - "OVER_MOBILIZED"
        - "READING_GROUP_TRAP"

  debug_ui_integration:
    display: "Raw JSON viewer panel"
    location: "Entity detail sidebar"
    features:
      - "Collapsible tags object"
      - "Flags displayed as chips/badges"
      - "Edit capability for testing"
      - "Filter entities by flag"
    purpose: |
      The Debug UI (God View) displays tags and flags in a raw JSON viewer.
      This allows developers to:
      - Inspect Epoch 2 properties during development
      - Verify calculations are correct
      - Manually modify values for testing
      - Filter entities by specific flags

  implementation:
    location: "src/babylon/models/entities/base.py (or similar)"
    changes:
      - "Add tags: Dict[str, Any] = Field(default_factory=dict)"
      - "Add flags: Set[str] = Field(default_factory=set)"
      - "Add helper methods: has_flag(), get_tag(), set_tag()"
    migration: "None - additive only, existing entities get empty tags/flags"
    backward_compatible: true

# =============================================================================
# ENTITY OVERVIEW
# =============================================================================

entities:

  character:
    id_pattern: "snake_case (e.g., persephone_raskova)"
    schema: "src/babylon/schemas/entities/character.schema.json"
    data: "src/babylon/data/game/characters.json"
    description: "Individual actors in the simulation"
    key_fields:
      - "faction: Faction membership"
      - "class_position: Their class"
      - "skills: Capabilities"
      - "beliefs: Ideological positions"
      - "relationships: Connections to other characters"
    relationships:
      - "belongs_to → Faction"
      - "located_in → Location"
      - "knows → Character"

  faction:
    id_pattern: "F001, F002, ..."
    schema: "src/babylon/schemas/entities/faction.schema.json"
    data: "src/babylon/data/game/factions.json"
    description: "Organized political forces"
    key_fields:
      - "class_composition: Which classes make up the faction"
      - "military_capacity: Armed capability"
      - "dialectical_relationships: Relations with other factions"
      - "ideology: Guiding ideology"
    relationships:
      - "controls → Location"
      - "allied_with/opposed_to → Faction"
      - "follows → Ideology"
      - "contains → Character"

  contradiction:
    id_pattern: "CON001, CON002, ..."
    schema: "src/babylon/schemas/entities/contradiction.schema.json"
    data: "src/babylon/data/game/contradictions.json"
    description: "Dialectical tensions driving change"
    key_fields:
      - "entities: The opposing forces"
      - "antagonism_type: antagonistic/non_antagonistic"
      - "intensity: Current sharpness"
      - "effects: What happens as intensity changes"
    relationships:
      - "involves → Entity (any type)"
      - "manifests_as → Crisis"
      - "intensified_by → Event"

  location:
    id_pattern: "L001, L001A, ..."
    schema: "src/babylon/schemas/entities/location.schema.json"
    data: "src/babylon/data/game/locations.json"
    description: "Geographic/political spaces"
    key_fields:
      - "coordinates: Lat/long"
      - "parent_location: Hierarchy"
      - "sub_locations: Children"
      - "controlling_faction: Who rules"
      - "resources: What's produced here"
    relationships:
      - "contains → Location (sub-locations)"
      - "produces → Resource"
      - "controlled_by → Faction"

  resource:
    id_pattern: "R001, R002, ..."
    schema: "src/babylon/schemas/entities/resource.schema.json"
    data: "src/babylon/data/game/resources.json"
    description: "Economic inputs and outputs"
    key_fields:
      - "category: Type of resource"
      - "scarcity: Abundance level"
      - "production: How it's made"
      - "consumption: Who uses it"
    relationships:
      - "produced_at → Location"
      - "consumed_by → Faction"
      - "required_for → Technology"

  technology:
    id_pattern: "T001, T002, ..."
    schema: "src/babylon/schemas/entities/technology.schema.json"
    data: "src/babylon/data/game/technologies.json"
    description: "Researchable capabilities"
    key_fields:
      - "category: Economic/Control/Liberation/Repression"
      - "prerequisites: Required prior tech"
      - "effects: What it enables"
      - "available_to_classes: Class restrictions"
      - "dialectical_contradictions: Internal tensions"
    relationships:
      - "requires → Technology (prerequisites)"
      - "unlocks → Technology"
      - "available_to → Class"
    note: "T006-T011 are LLM-related technologies"

  movement:
    id_pattern: "M001, M002, ..."
    schema: "src/babylon/schemas/entities/movement.schema.json"
    data: "src/babylon/data/game/movements.json"
    description: "Broad political currents (less organized than factions)"
    key_fields:
      - "goals: What they want"
      - "tactics: How they operate"
      - "challenges: What they face"
    relationships:
      - "supported_by → Class"
      - "opposed_by → Faction"
      - "may_crystallize_into → Faction"

  class:
    id_pattern: "C001 or snake_case (bourgeoisie, proletariat)"
    schema: "src/babylon/schemas/entities/class.schema.json"
    data: "src/babylon/data/game/classes.json"
    description: "Relation to means of production"
    key_fields:
      - "relation_to_production: Owner/seller/etc."
      - "interests: Material interests"
      - "ideology: IdeologicalProfile (multi-dimensional consciousness)"
    relationships:
      - "exploits → Class"
      - "exploited_by → Class"
      - "comprises → Faction (class composition)"

  ideological_profile:
    id_pattern: "Embedded in SocialClass.ideology"
    location: "src/babylon/models/entities/social_class.py"
    description: "Multi-dimensional consciousness model (Sprint 3.4.3 George Jackson Refactor)"
    key_fields:
      - "class_consciousness: Float [0, 1] - Vertical Axis (Capital vs Labor)"
      - "national_identity: Float [0, 1] - Horizontal Axis (Internationalist vs Nativist)"
      - "agitation: Float [0, ∞) - Energy magnitude from crisis"
    dynamics:
      crisis_routing: |
        When wages fall, agitation energy is generated.
        Agitation + Solidarity → class_consciousness increases (Revolution path)
        Agitation + No Solidarity → national_identity increases (Fascism path)
    formula: "calculate_ideological_routing(wage_change, solidarity_pressure, current_profile)"
    key_insight: "Fascism is the defensive form of capitalism."
    note: "Replaced scalar ideology: float [-1, 1] in Sprint 3.4.3"

  crisis:
    id_pattern: "CRISIS_001, CRISIS_002, ..."
    schema: "src/babylon/schemas/entities/crisis.schema.json"
    data: "src/babylon/data/game/crises.json"
    description: "Acute manifestations of contradictions"
    key_fields:
      - "type: Economic/political/legitimacy/ecological"
      - "severity: Intensity"
      - "triggers: What caused it"
      - "effects: Consequences"
    relationships:
      - "manifests → Contradiction"
      - "affects → Location"
      - "may_trigger → Revolt"

  policy:
    id_pattern: "Policy ID"
    schema: "src/babylon/schemas/entities/policy.schema.json"
    data: "src/babylon/data/game/policies.json"
    description: "Government/faction actions"
    key_fields:
      - "type: Economic/social/political"
      - "effects: What it does"
      - "support/opposition: Class reactions"

  institution:
    id_pattern: "Inst001, Inst002, ..."
    schema: "src/babylon/schemas/entities/institution.schema.json"
    data: "src/babylon/data/game/institutions.json"
    description: "Organized structures (state apparatus, civil society)"
    key_fields:
      - "type: State/civil/economic"
      - "function: What it does"
      - "controlled_by: Which class/faction"
    note: "Distinction between repressive and ideological apparatus"

  ideology:
    id_pattern: "IDE001, IDE002, ..."
    schema: "src/babylon/schemas/entities/ideology.schema.json"
    data: "src/babylon/data/game/ideologies.json"
    description: "Systems of belief and worldview"
    key_fields:
      - "core_beliefs: Central tenets"
      - "class_basis: Which class it serves"
    relationships:
      - "adopted_by → Faction"
      - "opposed_to → Ideology"

  culture:
    id_pattern: "CUL001, CUL002, ..."
    schema: "src/babylon/schemas/entities/culture.schema.json"
    data: "src/babylon/data/game/cultures.json"
    description: "Cultural groups and practices"
    key_fields:
      - "traditions: Cultural practices"
      - "values: Core values"

  law:
    id_pattern: "LAW001, LAW002, ..."
    schema: "src/babylon/schemas/entities/law.schema.json"
    data: "src/babylon/data/game/laws.json"
    description: "Legal framework elements"
    key_fields:
      - "type: Constitutional/criminal/economic"
      - "effects: What it enforces"
      - "class_bias: Who benefits"

  revolt:
    id_pattern: "Revolt ID"
    schema: "src/babylon/schemas/entities/revolt.schema.json"
    data: "src/babylon/data/game/revolts.json"
    description: "Uprising events"
    key_fields:
      - "participants: Who's involved"
      - "demands: What they want"
      - "outcome: Success/failure/ongoing"
    relationships:
      - "triggered_by → Crisis"
      - "led_by → Faction/Movement"
      - "occurs_in → Location"

  relationship:
    id_pattern: "Relationship ID"
    schema: "src/babylon/schemas/entities/relationship.schema.json"
    data: "src/babylon/data/game/relationships.json"
    description: "Connections between entities"
    key_fields:
      - "source/target: Linked entities"
      - "type: Nature of relationship"
      - "strength: Intensity"
    note: "Meta-entity describing other entity connections"

  sentiment:
    id_pattern: "Sentiment ID"
    schema: "src/babylon/schemas/entities/sentiment.schema.json"
    data: "src/babylon/data/game/sentiments.json"
    description: "Public opinion patterns"
    key_fields:
      - "type: Pro/anti various positions"
      - "magnitude: Strength"
      - "region: Where"
    note: "Currently unpopulated - planned feature"

# =============================================================================
# ENTITY RELATIONSHIPS GRAPH
# =============================================================================

relationship_overview:
  note: "Simplified view of how entities connect"
  graph: |
    Character ─belongs_to→ Faction ─controls→ Location
        │                     │                   │
        └──located_in────────┘                   │
                              │                   │
                              ├─follows→ Ideology │
                              │                   │
                              ├─opposes→ Faction  │
                              │                   │
    Class ─comprises────────→─┤                   │
                              │                   │
    Movement ─may_become────→─┘                   │
                                                  │
    Resource ←──produces──────────────────────────┘
        │
        └─required_for→ Technology

    Contradiction ─involves→ [any entity]
        │
        └─manifests_as→ Crisis ─triggers→ Revolt

# =============================================================================
# COMMON QUERIES
# =============================================================================

common_queries:

  find_faction_by_id:
    pattern: "factions.json → filter by id"

  get_location_resources:
    pattern: "locations.json → location.resources[]"

  find_contradictions_involving:
    pattern: "contradictions.json → filter entities[] contains target"

  tech_tree_traversal:
    pattern: "technologies.json → follow prerequisites chains"

  class_composition_of_faction:
    pattern: "factions.json → faction.class_composition[]"
