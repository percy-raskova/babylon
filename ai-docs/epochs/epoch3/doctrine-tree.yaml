# The Doctrine System - Ideological Line Struggle
# Epoch 2: The Game
#
# "The correctness or incorrectness of the ideological and political line
# decides everything."
# - Mao Zedong
#
# Unlike standard tech trees, this system contains mutually exclusive splits,
# traps, and degeneration paths. Your ideology is not neutral infrastructure.
# It determines what you CAN do and what you WILL BECOME.

meta:
  epoch: 3
  sub_epoch: "3B"
  slice: "3.8"
  slice_name: "The Doctrine System"
  status: PLANNED
  priority: MEDIUM
  version: "1.0.0"
  created: "2025-12-26"
  purpose: "Model ideological development as DAG with splits, traps, and degeneration"
  core_mechanic: "The Party Congress (Resource: Theoretical Labor)"
  scope_note: "Full 8-trunk system specified; implement 3 trunks for Sub-Epoch 2B MVP"

  theoretical_foundation:
    primary: "Lenin - What Is To Be Done? (1902) - The question of ideology"
    secondary: "Mao - On Contradiction (1937) - Principal vs. secondary contradictions"
    tertiary: "Gramsci - Prison Notebooks - Organic intellectuals and hegemony"
    critical: "Althusser - Ideology and Ideological State Apparatuses (1970)"
    warning: "Zizek - Did Somebody Say Totalitarianism? - On ideological traps"

  design_principle: |
    The Doctrine Tree is NOT a tech tree. It is a MAP OF IDEOLOGICAL STRUGGLE.

    Key differences from standard tech trees:
    1. MUTUALLY EXCLUSIVE branches (you cannot have both Focoism and Mass Line)
    2. TRAP endings that seem like victories but lead to defeat
    3. DEGENERATION paths that transform you into what you fought against
    4. MAINTENANCE costs (ideology degrades without continuous investment)

    The player must navigate between:
    - Reformism (legal, popular, impotent)
    - Adventurism (militant, isolated, crushed)
    - Autonomism (resilient, irrelevant)
    - Scientific Socialism (balanced, demanding)

    AND avoid the ultimate trap:
    - National Socialism (the degeneration into fascism)

    "Every position on the tree is a position in the class struggle."

# =============================================================================
# ANTI-PATTERN WARNING
# =============================================================================

anti_pattern_warning:
  for_designers: |
    THE TREE MUST HAVE NO "OPTIMAL PATH."
    If one branch is clearly best, players will always take it.
    The tree must present GENUINE DILEMMAS with real tradeoffs.

    Each trunk must be:
    - Playable to victory (in theory)
    - Dangerous in specific ways
    - Tempting for different player styles

    The traps must be:
    - Attractive (otherwise no one falls in)
    - Escapable (with cost)
    - Narratively coherent (not arbitrary failure)

  for_players: |
    THERE IS NO "RIGHT ANSWER" IN THE ABSTRACT.
    The correct doctrine depends on:
    - Material conditions (what does the map allow?)
    - State behavior (what can you get away with?)
    - Player skill (can you maintain the demanding paths?)

    The Scientific Trunk is NOT automatically correct.
    It is correct WHEN CONDITIONS ALLOW.
    Attempting Leninism in 1840s France is adventurism.
    Attempting Reformism in 1917 Russia is liquidationism.

    "The concrete analysis of concrete conditions is the living soul of Marxism."

# =============================================================================
# CORE RESOURCE: THEORETICAL LABOR (TL)
# =============================================================================

theoretical_labor:
  symbol: "TL"
  name: "Theoretical Labor"
  description: |
    The resource spent to develop, maintain, and propagate doctrine.
    Generated by Cadre engaged in study, writing, and education.

  generation:
    primary: |
      TL_Generated = Cadre_Count * Study_Allocation * Coherence_Factor

      Where:
      - Cadre_Count: Number of Cadre assigned to theory work
      - Study_Allocation: Fraction of Cadre time on theory (0.0 - 1.0)
      - Coherence_Factor: From Vanguard Economy (organizational health)

    secondary: "Crisis events may generate 'spontaneous theory' (limited)"

  uses:
    doctrine_acquisition:
      description: "Unlock new doctrine nodes"
      cost: "Varies by node (50 - 500 TL)"

    doctrine_maintenance:
      description: "Prevent doctrine decay"
      cost: "10% of acquisition cost per 10 ticks"
      failure: "Unmaintained doctrines degrade toward parent node"

    congress_action:
      description: "The Party Congress - major ideological shift"
      cost: "500 TL minimum"
      effect: "Can change trunk, resolve contradictions, or purge deviations"

  constraints:
    opportunity_cost: |
      Cadre doing theory are NOT doing:
      - Agitation (generating Sympathizers)
      - Operations (Kinetic Warfare)
      - Organization (building Cohesion)

      Theoretical development requires SACRIFICE of immediate capacity.

    coherence_requirement: |
      Low Coherence = Low TL generation
      A disorganized party cannot develop coherent theory.
      This creates feedback loop with Vanguard Economy.

  code_type:
    type: "int"
    unit: "theoretical_labor_points"
    minimum: 0

# =============================================================================
# THE TAG SYSTEM (Ideological DNA)
# =============================================================================

tag_system:
  overview: |
    Tags represent the capabilities and limitations of your ideological line.
    They are NOT arbitrary bonuses. They reflect real-world constraints:
    - A legal party cannot assassinate without losing legality
    - A secret party cannot run candidates
    - A militant party alienates moderates
    - A popular party attracts opportunists

  tags:
    legality:
      id: "LEGALITY"
      description: "Ability to operate openly within bourgeois legal framework"
      range: "0 - 10"
      effects:
        high: |
          - Can run electoral candidates
          - Can hold public events
          - Can use legal infrastructure (banks, property)
          - Can appeal to liberal sympathy
        low: |
          - Cannot operate openly
          - Subject to immediate arrest
          - Must use clandestine infrastructure
          - Alienated from liberal allies
      tradeoffs: |
        High LEGALITY requires:
        - Avoiding "illegal" tactics
        - Accepting bourgeois rules of the game
        - Moderating public messaging

    militancy:
      id: "MILITANCY"
      description: "Ability and willingness to use force"
      range: "0 - 10"
      effects:
        high: |
          - Can execute Kinetic Warfare actions
          - Higher damage in combat
          - Deterrence effect on State
          - Attracts radicals
        low: |
          - Cannot use violence
          - Purely defensive posture
          - State does not fear you
          - Attracts moderates
      tradeoffs: |
        High MILITANCY requires:
        - Accepting collateral damage
        - Alienating pacifist allies
        - Accepting State prioritization

    mass_link:
      id: "MASS_LINK"
      description: "Connection to and influence over the broad masses"
      range: "0 - 10"
      effects:
        high: |
          - Faster Sympathizer generation
          - Human shield effect (State hesitates)
          - Access to mass actions (strikes, protests)
          - Legitimacy in crisis moments
        low: |
          - Isolated from population
          - No mass base for defense
          - Actions seen as "terrorism"
          - Vulnerable to QRF
      tradeoffs: |
        High MASS_LINK requires:
        - Accepting reformist elements
        - Moderating messaging for normies
        - Slower, more patient organizing

    secrecy:
      id: "SECRECY"
      description: "Resistance to State surveillance and infiltration"
      range: "0 - 10"
      effects:
        high: |
          - Reduced State visibility
          - Protected from Investigation
          - Can maintain clandestine networks
          - Leadership survives QRF
        low: |
          - State sees everything
          - Easily infiltrated
          - Leadership exposed
          - Vulnerable to decapitation
      tradeoffs: |
        High SECRECY requires:
        - Accepting slower growth
        - Limiting public presence
        - Paranoid operational security

    nationalism:
      id: "NATIONALISM"
      description: "The dangerous variable - appeal to national identity"
      range: "0 - 10"
      warning: "HIGH NATIONALISM + LOW CLASS_ANALYSIS = FASCISM PATH"
      effects:
        moderate: |
          - Can appeal to national liberation movements
          - Useful in anti-imperial struggle
          - Connects to popular sentiment
        high: |
          - Opens "Patriotic Socialism" path
          - Alienates internationalist allies
          - Attracts reactionary elements
          - DANGER: Degeneration path available
        extreme: |
          - Degeneration into National Syndicalism
          - Player becomes the enemy
          - "Strasserite" ending

    class_analysis:
      id: "CLASS_ANALYSIS"
      description: "Clarity and consistency of materialist class analysis"
      range: "0 - 10"
      effects:
        high: |
          - Blocks fascist degeneration paths
          - Correct prioritization of enemies
          - Attracts serious cadre
          - Theory generation bonus
        low: |
          - Vulnerable to degeneration
          - Confused friend/enemy distinction
          - Attracts opportunists
          - Opens "PatSoc" path
      relationship: |
        CLASS_ANALYSIS is the ANTIDOTE to NATIONALISM.
        As long as CLASS_ANALYSIS > NATIONALISM, you are safe.
        When NATIONALISM > CLASS_ANALYSIS, the wormhole opens.

    resilience:
      id: "RESILIENCE"
      description: "Ability to survive state repression and maintain continuity"
      range: "0 - 10"
      effects:
        high: |
          - Survives QRF with reduced casualties
          - Faster recovery from crackdowns
          - Distributed structure
          - "Hydra" effect (cut off one head...)
        low: |
          - Vulnerable to decapitation
          - Slow recovery from damage
          - Centralized weak points

# =============================================================================
# THE FOUR TRUNKS
# =============================================================================

trunks:
  overview: |
    The Doctrine Tree has four main trunks, each representing a distinct
    strategic orientation. Players must commit to one primary trunk,
    though limited cross-pollination is possible.

  reformist:
    name: "The Reformist Trunk"
    slogan: "The Ballot, Not the Bullet"
    color: "#4a90d9"  # Blue

    primary_tags:
      LEGALITY: "HIGH (8-10)"
      MASS_LINK: "HIGH (7-10)"
      MILITANCY: "LOW (0-2)"
      SECRECY: "LOW (0-3)"

    strategic_vision: |
      Change the system from within. Win elections, pass laws,
      build mass coalitions. The legal path to power.

    strengths:
      - "Maximum access to legal resources"
      - "Broadest possible coalition"
      - "Least immediate State repression"
      - "Appeal to liberal sympathy"

    weaknesses:
      - "Cannot challenge fundamental structures"
      - "Vulnerable to co-optation"
      - "Dependent on bourgeois institutions"
      - "Impotent in revolutionary crisis"

    historical_examples:
      - "German SPD (pre-1914)"
      - "Salvador Allende's Unidad Popular"
      - "Jeremy Corbyn's Labour"
      - "DSA (Democratic Socialists of America)"

    trap_node:
      name: "Liquidationism"
      trigger: "LEGALITY = 10 AND MILITANCY = 0 AND crisis_level > 0.8"
      effect: |
        Revolutionary potential reduced to ZERO.
        You have become a manager of capitalism.
        The party exists, but it cannot transform anything.

      game_over_narrative: |
        "ELECTORAL SOCIALISM: The Managed Decline"

        You won. The election, that is. Your candidate sits in the
        highest office. Your party holds the legislature.

        And nothing changed.

        The banks are still banks. The police still police.
        The borders still divide. The climate still burns.

        You had power. You just couldn't use it for anything
        that mattered. The system absorbed your victory and
        continued as before.

        "We moved left within the possible."
        The possible was always their territory.

        THE APOCALYPSE CONTINUES, BUT NOW YOU MANAGE IT.

  insurrectionist:
    name: "The Insurrectionist Trunk"
    slogan: "The Spark That Lights the Prairie Fire"
    color: "#e74c3c"  # Red

    primary_tags:
      MILITANCY: "HIGH (8-10)"
      SECRECY: "HIGH (7-10)"
      LEGALITY: "LOW (0-2)"
      MASS_LINK: "LOW (2-4)"

    strategic_vision: |
      The armed vanguard. Strike the oppressor, inspire the masses.
      Revolution comes from the barrel of a gun.

    strengths:
      - "Maximum combat effectiveness"
      - "Protected from surveillance"
      - "Can execute decisive actions"
      - "Inspires radical elements"

    weaknesses:
      - "Isolated from mass base"
      - "No human shield effect"
      - "Actions framed as terrorism"
      - "Vulnerable to political defeat"

    historical_examples:
      - "Che Guevara's Foco Theory"
      - "Red Army Faction (RAF)"
      - "Weather Underground"
      - "Red Brigades"

    trap_node:
      name: "Adventurism"
      trigger: "MILITANCY = 10 AND MASS_LINK < 3 AND failed_attacks > 3"
      effect: |
        Mass Link reduced to ZERO.
        You are seen as terrorists, not liberators.
        The masses fear you more than the State.

      game_over_narrative: |
        "THE PROPAGANDA OF THE DEED: The Spiral"

        You struck. Again and again. Banks, barracks, bridges.
        Each action more dramatic than the last.

        And the people watched in horror.

        Not horror at the State. Horror at YOU.
        "Those maniacs," they said. "Thank god for the police."

        Your communiques went unread. Your demands ignored.
        The State used your actions to justify everything.
        Every surveillance camera. Every midnight raid.

        You wanted to be the spark. You became the excuse.

        THE REVOLUTION DIED SO YOUR WAR COULD CONTINUE.

  autonomist:
    name: "The Autonomist Trunk"
    slogan: "Build the New World in the Shell of the Old"
    color: "#27ae60"  # Green

    primary_tags:
      RESILIENCE: "HIGH (8-10)"
      SECRECY: "MEDIUM (4-6)"
      MASS_LINK: "MEDIUM (4-6)"
      MILITANCY: "LOW (2-4)"
      LEGALITY: "MEDIUM (4-6)"

    strategic_vision: |
      Prefigurative politics. Build autonomous zones, mutual aid
      networks, counter-institutions. Withdraw from the system.

    strengths:
      - "Maximum survivability"
      - "Cannot be decapitated"
      - "Builds real alternative structures"
      - "Attracts disillusioned liberals"

    weaknesses:
      - "Cannot confront State power directly"
      - "Easily ignored by the system"
      - "Vulnerable to gentrification/co-optation"
      - "Retreats from rather than resolves contradictions"

    historical_examples:
      - "Zapatistas (EZLN)"
      - "Rojava (until Turkish invasion)"
      - "Mutual Aid Networks"
      - "Squatter Movements"

    trap_node:
      name: "Dissociation"
      trigger: "RESILIENCE = 10 AND external_engagement < 0.2 AND ticks > 100"
      effect: |
        The organization becomes a lifestyle enclave.
        History continues without you.
        You are comfortable, irrelevant, and doomed.

      game_over_narrative: |
        "THE COMMUNE: A Beautiful Irrelevance"

        Your zone is perfect. Solar panels. Consensus meetings.
        Organic gardens. Conflict resolution circles.

        And outside, the empire burns.

        You built utopia for 500 people while billions suffered.
        The State didn't crush you. It didn't need to.
        You removed yourself from history.

        When the climate collapsed, your garden died too.
        When the fascists came, your circles meant nothing.
        You had built the new world. It was very small.

        THE SHELL COLLAPSED. THE NEW WORLD DIED INSIDE IT.

  scientific:
    name: "The Scientific Trunk (Leninist/Maoist)"
    slogan: "From the Masses, To the Masses"
    color: "#9b59b6"  # Purple

    primary_tags:
      CLASS_ANALYSIS: "HIGH (8-10)"
      MASS_LINK: "MEDIUM-HIGH (5-8)"
      MILITANCY: "MEDIUM (4-7)"
      SECRECY: "MEDIUM (4-7)"
      LEGALITY: "VARIABLE (context-dependent)"

    strategic_vision: |
      The synthesis. Mass line + armed struggle. Legal work where
      possible, clandestine where necessary. Correct analysis of
      concrete conditions. Constant rectification.

    strengths:
      - "Balanced capabilities"
      - "Adaptable to conditions"
      - "Historically successful"
      - "Protected from degeneration (high CLASS_ANALYSIS)"

    weaknesses:
      - "HIGHEST maintenance cost"
      - "Requires constant theoretical work"
      - "Vulnerable to bureaucratization"
      - "Demands skilled leadership"

    historical_examples:
      - "Bolsheviks (1917)"
      - "Chinese Communist Party (1949)"
      - "Vietnamese Liberation Front"
      - "Cuban Revolution"

    maintenance_requirement: |
      The Scientific Trunk requires CONTINUOUS investment.
      If TL generation drops below maintenance threshold:
      - Doctrine begins degenerating
      - Bureaucratic Centralism temptation appears
      - Class Analysis erodes

    degeneration_warning: |
      WITHOUT maintenance, the Scientific Trunk degenerates into:
      - Bureaucratic Centralism (SECRECY without MASS_LINK)
      - Commandism (MILITANCY without MASS_LINK)
      - Tailism (MASS_LINK without CLASS_ANALYSIS)

      "The party that stops studying stops being a party."

# =============================================================================
# DOCTRINE NODES (Sample)
# =============================================================================

doctrine_nodes:
  note: "This is a representative sample. Full tree in implementation."

  # Root Node (all players start here)
  class_consciousness:
    id: "class_consciousness"
    name: "Class Consciousness"
    tier: 0
    parent: null
    description: "The fundamental recognition that society is divided into classes."
    provides_tags:
      CLASS_ANALYSIS: 1
    resource_cost: 0  # Starting node
    conflicts_with: []

  # Tier 1: First Split
  trade_unionism:
    id: "trade_unionism"
    name: "Trade Unionism"
    tier: 1
    parent: ["class_consciousness"]
    description: "Organize workers at the point of production."
    provides_tags:
      MASS_LINK: 2
      LEGALITY: 1
    resource_cost: 50
    conflicts_with: []
    leads_to: ["reformist_trunk", "scientific_trunk"]

  propaganda_of_deed:
    id: "propaganda_of_deed"
    name: "Propaganda of the Deed"
    tier: 1
    parent: ["class_consciousness"]
    description: "Actions speak louder than words."
    provides_tags:
      MILITANCY: 2
      SECRECY: 1
    resource_cost: 50
    conflicts_with: ["trade_unionism"]
    leads_to: ["insurrectionist_trunk"]
    warning: "This path limits MASS_LINK development."

  mutual_aid:
    id: "mutual_aid"
    name: "Mutual Aid"
    tier: 1
    parent: ["class_consciousness"]
    description: "Build the new world in the shell of the old."
    provides_tags:
      RESILIENCE: 2
      MASS_LINK: 1
    resource_cost: 50
    conflicts_with: []
    leads_to: ["autonomist_trunk"]

  # Tier 2: Trunk Commitment
  democratic_centralism:
    id: "democratic_centralism"
    name: "Democratic Centralism"
    tier: 2
    parent: ["trade_unionism"]
    description: "Freedom of discussion, unity of action."
    provides_tags:
      CLASS_ANALYSIS: 2
      SECRECY: 2
      MASS_LINK: 1
    resource_cost: 100
    conflicts_with: ["bureaucratic_centralism", "anarchist_federalism"]
    requires: ["trade_unionism"]
    trunk: "scientific"
    maintenance_cost: 15  # TL per 10 ticks

  electoral_socialism:
    id: "electoral_socialism"
    name: "Electoral Socialism"
    tier: 2
    parent: ["trade_unionism"]
    description: "The ballot box is the path to power."
    provides_tags:
      LEGALITY: 3
      MASS_LINK: 2
    provides_tags_negative:
      MILITANCY: -2
    resource_cost: 100
    conflicts_with: ["clandestine_organization"]
    requires: ["trade_unionism"]
    trunk: "reformist"

  focoism:
    id: "focoism"
    name: "Focoism"
    tier: 2
    parent: ["propaganda_of_deed"]
    description: "The guerrilla foco will ignite the masses."
    provides_tags:
      MILITANCY: 3
      SECRECY: 2
    provides_tags_negative:
      MASS_LINK: -2
    resource_cost: 100
    conflicts_with: ["mass_line"]
    requires: ["propaganda_of_deed"]
    trunk: "insurrectionist"
    historical_note: "Che's strategy. Failed in Bolivia."

  # Tier 3: Key Doctrines
  mass_line:
    id: "mass_line"
    name: "Mass Line"
    tier: 3
    parent: ["democratic_centralism"]
    description: "From the masses, to the masses."
    provides_tags:
      MASS_LINK: 3
      CLASS_ANALYSIS: 1
    resource_cost: 150
    conflicts_with: ["focoism", "bureaucratic_centralism"]
    requires: ["democratic_centralism"]
    trunk: "scientific"
    maintenance_cost: 20

    mechanic: |
      The Mass Line provides a unique action:
      "Mass Investigation" - Spend TL to gain insight into
      territory Consciousness and needs. Reduces Agitation
      cost in that territory.

  protracted_peoples_war:
    id: "protracted_peoples_war"
    name: "Protracted People's War"
    tier: 3
    parent: ["mass_line"]
    description: "The countryside surrounds the city."
    provides_tags:
      MILITANCY: 2
      MASS_LINK: 2
      RESILIENCE: 2
    resource_cost: 200
    conflicts_with: ["urban_insurrection"]
    requires: ["mass_line"]
    trunk: "scientific"
    maintenance_cost: 25

    geographic_requirement: |
      Requires control of rural territories.
      Not available in purely urban scenarios.

  # DANGER ZONE: Nationalism Doctrines
  national_liberation:
    id: "national_liberation"
    name: "National Liberation"
    tier: 2
    parent: ["class_consciousness"]
    description: "The nation oppressed must be liberated."
    provides_tags:
      NATIONALISM: 2
      MASS_LINK: 2
      MILITANCY: 1
    resource_cost: 100
    conflicts_with: []
    requires: ["class_consciousness"]

    warning: |
      NATIONALISM tag begins accumulating.
      Safe as long as CLASS_ANALYSIS >= NATIONALISM.
      Used correctly: Anti-imperial liberation.
      Used incorrectly: Path to fascism.

    valid_use: |
      In colonized territories, national liberation is
      objectively progressive. The key is maintaining
      class analysis WITHIN the national movement.

  patriotic_socialism:
    id: "patriotic_socialism"
    name: "Patriotic Socialism"
    tier: 3
    parent: ["national_liberation"]
    description: "Socialism in one country. Our nation first."
    provides_tags:
      NATIONALISM: 3
      MASS_LINK: 2
    provides_tags_negative:
      CLASS_ANALYSIS: -2
    resource_cost: 150
    requires: ["national_liberation"]

    danger: |
      CLASS_ANALYSIS begins DECREASING.
      If NATIONALISM > CLASS_ANALYSIS:
      The degeneration wormhole OPENS.

    warning_signs:
      - "Rhetoric shifts from class to nation"
      - "Alliances with 'patriotic' bourgeoisie"
      - "Hostility to 'cosmopolitan' elements"
      - "Defense of 'traditional values'"

  # THE WORMHOLE
  national_syndicalism:
    id: "national_syndicalism"
    name: "National Syndicalism"
    tier: 4
    parent: ["patriotic_socialism"]
    description: "The workers and the nation are one."
    provides_tags:
      NATIONALISM: 4
      MASS_LINK: 3
      MILITANCY: 2
    provides_tags_negative:
      CLASS_ANALYSIS: -3
    resource_cost: 200
    requires: ["patriotic_socialism"]
    requires_condition: "NATIONALISM > CLASS_ANALYSIS"

    point_of_no_return_warning: |
      THIS IS THE LAST EXIT.
      Beyond here lies only fascism.
      You can still turn back with a Party Congress.
      Cost: 500 TL + purge of nationalist elements.

  strasserism:
    id: "strasserism"
    name: "Strasserism"
    tier: 5
    parent: ["national_syndicalism"]
    description: "National revolution against both capital and Marxism."
    provides_tags:
      NATIONALISM: 5
      MILITANCY: 4
    provides_tags_negative:
      CLASS_ANALYSIS: -5
    resource_cost: 0  # Falls into this, doesn't choose it
    requires: ["national_syndicalism"]
    requires_condition: "CLASS_ANALYSIS <= 0"

    effect: |
      GAME TRANSFORMATION: You become the Enemy Faction.
      The player organization is now functionally fascist.
      All previous allies become enemies.
      The State may now RECRUIT you as auxiliary force.

    game_over_narrative: |
      "THE BETRAYAL: When the Abyss Gazed Back"

      You gazed into the abyss. And here you are.

      It happened slowly. First, the nation. Then, the race.
      The workers became "our workers." The enemy became
      "them." The revolution became "national renewal."

      You kept the red flags. You kept the worker rhetoric.
      But the content changed. Class war became race war.
      Liberation became domination. Solidarity became tribe.

      The actual fascists welcomed you. "You understand now,"
      they said. And you did. You understood everything wrong.

      Your former comrades fight you now. They were right to.
      You are not the revolutionary vanguard.
      You are the final form of reaction.

      THE REVOLUTION DEVOURED ITSELF.

# =============================================================================
# SHARED PRAXIS (Cross-Trunk Tactics)
# =============================================================================

shared_praxis:
  overview: |
    Some tactics are available across trunks, provided you have
    sufficient tags. These represent practical actions that
    transcend ideological divisions.

  tactics:
    general_strike:
      name: "General Strike"
      description: "Halt production across a territory."
      requirements:
        MASS_LINK: ">= 5"
        minimum_sl: 10000
      effect: |
        - Extraction Nodes disabled for 3 ticks
        - Imperial Rent reduced by 20%
        - Consciousness boost if successful
      available_to: ["reformist", "scientific"]
      unavailable_to: ["insurrectionist"]  # Lacks mass base

    armed_propaganda:
      name: "Armed Propaganda"
      description: "Armed action with explicit political messaging."
      requirements:
        MILITANCY: ">= 4"
        MASS_LINK: ">= 3"
      effect: |
        - Kinetic action with reduced Collateral
        - Message distributed during action
        - Consciousness effect if framed correctly
      available_to: ["scientific"]
      unavailable_to: ["reformist", "autonomist"]

    mutual_aid_network:
      name: "Mutual Aid Network"
      description: "Establish parallel support structures."
      requirements:
        RESILIENCE: ">= 4"
        MASS_LINK: ">= 3"
      effect: |
        - Passive Sympathizer generation
        - Reduced Consciousness decay
        - Survival support during crisis
      available_to: ["autonomist", "scientific"]
      unavailable_to: ["insurrectionist"]

    electoral_campaign:
      name: "Electoral Campaign"
      description: "Run candidates for office."
      requirements:
        LEGALITY: ">= 7"
        MASS_LINK: ">= 5"
      effect: |
        - If successful: Reduce local Repression
        - Platform reaches broad audience
        - Generates Sympathizers
      available_to: ["reformist"]
      unavailable_to: ["insurrectionist", "scientific"]  # Compromises position

    clandestine_network:
      name: "Clandestine Network"
      description: "Establish secret organizational infrastructure."
      requirements:
        SECRECY: ">= 6"
      effect: |
        - Reduced State visibility
        - Protected communications
        - Escape routes for leadership
      available_to: ["insurrectionist", "scientific"]
      unavailable_to: ["reformist"]  # Contradicts legality

# =============================================================================
# THE PARTY CONGRESS
# =============================================================================

party_congress:
  name: "The Party Congress"
  description: |
    The mechanism for major ideological shifts. Expensive but powerful.
    Represents internal struggle, debate, and resolution.

  cost:
    minimum_tl: 500
    cadre_requirement: 100  # Minimum Cadre to convene
    coherence_requirement: 0.5  # Cannot hold Congress in chaos

  actions:
    trunk_shift:
      description: "Change primary trunk orientation"
      cost: "1000 TL"
      effect: |
        - Lose 50% of current trunk tags
        - Gain access to new trunk
        - Purge of opposed elements (Cadre loss)
        - Reset some degeneration progress
      restriction: "Cannot shift directly to degenerated position"

    rectification:
      description: "Purge opportunist/deviationist elements"
      cost: "500 TL"
      effect: |
        - Remove one negative doctrine
        - Increase CLASS_ANALYSIS by 1
        - Lose Cadre associated with purged line
        - Reduce NATIONALISM if elevated

    theoretical_offensive:
      description: "Major push for ideological development"
      cost: "750 TL"
      effect: |
        - Unlock one new doctrine without normal prerequisites
        - Increase tag caps by 1
        - Generate passive TL for 10 ticks

    self_criticism:
      description: "Acknowledge and correct errors"
      cost: "300 TL"
      effect: |
        - Escape from trap node (if not fully degenerated)
        - Lose Reputation
        - Regain flexibility
        - "The party that cannot self-criticize is dead."

# =============================================================================
# THE PATSOC PIPELINE (Degeneration Example)
# =============================================================================

patsoc_pipeline_example:
  title: "How to Accidentally Become a Fascist"
  subtitle: "The PatSoc Pipeline"

  context: |
    This example demonstrates how a player can slide from
    legitimate anti-imperial politics into fascism through
    a series of seemingly reasonable choices.

  phase_1_legitimate_start:
    tick: 1-20
    player_state:
      trunk: "scientific"
      doctrines: ["class_consciousness", "trade_unionism", "democratic_centralism"]
      tags:
        CLASS_ANALYSIS: 3
        MASS_LINK: 3
        NATIONALISM: 0

    situation: |
      Player is building a solid Leninist organization.
      Facing imperial intervention in their region.
      The State is backed by foreign capital.

    temptation: |
      "National Liberation" doctrine available.
      Seems appropriate—fighting imperial domination.
      Many successful revolutions used national sentiment.

    player_choice: "Acquire National Liberation"

    result:
      new_doctrines: ["national_liberation"]
      tags:
        CLASS_ANALYSIS: 3
        NATIONALISM: 2
        MASS_LINK: 5

    assessment: "SAFE. CLASS_ANALYSIS > NATIONALISM. This is correct usage."

  phase_2_drift_begins:
    tick: 21-40
    situation: |
      Organization grows rapidly using national rhetoric.
      Class analysis is harder to maintain (requires TL).
      Nationalist messaging is popular and easy.

    temptation: |
      TL generation is low (Cadre focused on action).
      Scientific Trunk maintenance failing.
      "Patriotic Socialism" appears as easier option.

    player_choice: "Acquire Patriotic Socialism (skip maintenance)"

    result:
      new_doctrines: ["patriotic_socialism"]
      tags:
        CLASS_ANALYSIS: 1  # -2 from PatSoc
        NATIONALISM: 5
        MASS_LINK: 7

    warning_triggered: |
      ⚠️ NATIONALISM > CLASS_ANALYSIS
      ⚠️ Degeneration wormhole is now OPEN

    assessment: "DANGEROUS. CLASS_ANALYSIS has fallen below NATIONALISM."

  phase_3_allies_change:
    tick: 41-60
    situation: |
      Organization attracts "patriots" who reject class analysis.
      Old internationalist cadre uncomfortable with rhetoric.
      Leadership faces choice: purge nationalists or embrace them.

    available_choices:
      option_a:
        name: "Party Congress: Rectification"
        cost: "500 TL + lose 30% nationalist Cadre"
        effect: "Reduce NATIONALISM, restore CLASS_ANALYSIS, close wormhole"

      option_b:
        name: "Lean into nationalism"
        cost: "0 TL"
        effect: "Purge internationalists, embrace nationalist base"

    temptation: |
      Option A is expensive and painful.
      Option B is free and popular.
      The nationalist base is larger now.
      "We can keep class analysis internally..."

    player_choice: "Option B (embrace nationalism)"

    result:
      lost_cadre: "Internationalist faction leaves (40%)"
      gained_cadre: "Nationalist faction grows (60%)"
      tags:
        CLASS_ANALYSIS: 0  # Internationalists were carrying this
        NATIONALISM: 7

    assessment: "CRITICAL. CLASS_ANALYSIS at zero. Next node is fascism."

  phase_4_point_of_no_return:
    tick: 61-80
    situation: |
      "National Syndicalism" node now available.
      The organization's rhetoric is indistinguishable from fascism.
      Old allies are now enemies. New allies are suspect.

    last_warning: |
      ⚠️ POINT OF NO RETURN WARNING
      ⚠️ "National Syndicalism" leads directly to Strasserism
      ⚠️ Cost to reverse: 500 TL + massive restructuring

    player_choice: "Acquire National Syndicalism"

    result:
      new_doctrines: ["national_syndicalism"]
      tags:
        CLASS_ANALYSIS: -3
        NATIONALISM: 9

    assessment: "TERMINAL. One step from fascism."

  phase_5_transformation:
    tick: 81+
    trigger: |
      CLASS_ANALYSIS <= 0 AND NATIONALISM >= 5
      Automatic acquisition of "Strasserism"

    transformation: |
      The player organization becomes an ENEMY FACTION.
      All previous allies become hostile.
      The State evaluates you as potential auxiliary.
      Former comrades are now targets.

    game_over_screen: |
      "THE PATRIOTIC SOCIALIST PIPELINE"

      It started with the nation. It always does.

      You fought the empire. Correct. You rallied the people
      with patriotic sentiment. Understandable. You purged
      the "cosmopolitans" who weakened national unity. Logical.

      And somewhere along the way, you became what you hated.

      The workers you claimed to represent? They're still workers.
      But now they're "our" workers. The nation's workers.
      Different from "their" workers. The foreigners. The others.

      The class struggle became the national struggle.
      The national struggle became the racial struggle.
      The revolution became the Reich.

      You are the proof that the path matters.
      You are the warning that ideas have consequences.
      You are the fascist who thought he was a communist.

      GAME OVER: THE WORMHOLE CONSUMED YOU.

  lessons:
    - "Maintain CLASS_ANALYSIS through continuous TL investment"
    - "National liberation is valid but requires vigilance"
    - "The wormhole opens gradually, not suddenly"
    - "Rectification is expensive but cheaper than fascism"
    - "The easy path leads to the abyss"

# =============================================================================
# IMPLEMENTATION
# =============================================================================

implementation:
  priority: "MEDIUM - After resource economy and kinetic systems"
  estimated_complexity: "HIGH - DAG structure, tag calculations, narratives"

  data_structure:
    doctrine_node: |
      class DoctrineNode(BaseModel):
          id: str
          name: str
          tier: int
          parent: list[str]
          description: str
          provides_tags: dict[str, int]
          provides_tags_negative: dict[str, int] = {}
          resource_cost: int
          conflicts_with: list[str] = []
          requires: list[str] = []
          requires_condition: Optional[str] = None
          trunk: Optional[str] = None
          maintenance_cost: int = 0

    doctrine_tree: |
      class DoctrineTree(BaseModel):
          nodes: dict[str, DoctrineNode]
          acquired: set[str]
          tags: dict[str, int]

          def can_acquire(self, node_id: str) -> bool:
              node = self.nodes[node_id]
              # Check prerequisites
              # Check conflicts
              # Check tag requirements
              ...

          def calculate_tags(self) -> dict[str, int]:
              # Sum all provides_tags from acquired nodes
              ...

  checklist:
    models:
      - task: "Create DoctrineNode model"
        status: "TODO"
      - task: "Create DoctrineTree model"
        status: "TODO"
      - task: "Create Tag enum and calculations"
        status: "TODO"

    data:
      - task: "Define full doctrine tree (50+ nodes)"
        status: "TODO"
      - task: "Balance tag values"
        status: "TODO"
      - task: "Write trap narratives"
        status: "TODO"

    system:
      - task: "Create DoctrineSystem class"
        status: "TODO"
      - task: "Implement acquisition logic"
        status: "TODO"
      - task: "Implement maintenance decay"
        status: "TODO"
      - task: "Implement degeneration paths"
        status: "TODO"

    integration:
      - task: "Connect tags to Vanguard Economy"
        status: "TODO"
      - task: "Connect tags to Kinetic Warfare"
        status: "TODO"
      - task: "Connect to The Wire (narrative framing)"
        status: "TODO"

# =============================================================================
# CROSS-REFERENCES
# =============================================================================

cross_references:
  related_specs:
    - "ai-docs/vanguard-economy.yaml (TL generation from Cadre)"
    - "ai-docs/cohesion-mechanic.yaml (Coherence affects TL)"
    - "ai-docs/kinetic-warfare.yaml (MILITANCY requirements)"
    - "ai-docs/strategy-layer.yaml (Trap mechanics)"
    - "ai-docs/gramscian-wire-vision.yaml (Narrative outcomes)"
  theoretical:
    - "Lenin - What Is To Be Done? (1902)"
    - "Mao - On Contradiction (1937)"
    - "Gramsci - Prison Notebooks"
  implementation:
    - "src/babylon/models/doctrine.py (DoctrineTree)"
    - "src/babylon/engine/systems/doctrine.py (DoctrineSystem)"
    - "src/babylon/data/game/doctrine_tree.json (Node definitions)"
