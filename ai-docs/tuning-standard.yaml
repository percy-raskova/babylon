meta:
  name: "The 20-Year Entropy Standard"
  version: "2.0.0"
  updated: "2025-12-31"
  purpose: "Tuning methodology for realistic imperial decay over 1040 ticks"
  status: "ACTIVE"
  doctrine: "The Tragedy of Inevitability"
  references:
    rst: "docs/reference/tuning.rst"

overview: |
  The simulation asks "How does the empire die?" not "Can the empire survive?"
  The default state is COLLAPSE. Stability is temporary deviation.
  20-year timeline (1040 ticks) is sufficient to observe systematic decay.

teleological_pivot:
  old_question: "Can the empire survive?"
  new_question: "How does the empire die?"
  insight: "Collapse is default. Stability is temporary deviation."

eden_mode_problem:
  causes:
    - "Existence was free (base_subsistence = 0.0)"
    - "Earth was infinite (no biocapacity hysteresis)"
    - "Zombies were possible (entities survive with near-zero wealth)"
  result: "Flatline simulations where nothing happened"

dying_world_physics:
  principles:
    - name: "Existence costs calories"
      rule: "base_subsistence > 0.0 always (The Calorie Check)"
      parameter: "economy.base_subsistence"
      implemented: true
    - name: "Earth remembers wounds"
      rule: "Extraction causes permanent hysteresis in max_biocapacity"
      parameter: "metabolism.hysteresis_rate"
      implemented: false  # NOTE: NOT YET IN GameDefines
    - name: "Death is real"
      rule: "VitalitySystem kills entities when wealth < consumption_needs"
      implemented: true

benchmark:
  duration:
    old: "52 ticks (1 year)"
    new: "1040 ticks (20 years)"
  rationale:
    - "Long enough to observe TRPF"
    - "Long enough for ecological degradation to compound"
    - "Long enough for generational effects"
    - "Short enough for meaningful simulation runs (~10-20 minutes)"

success_criteria:
  deprecated: "Success = Survival"
  current: "Success = Realistic Decay"
  ideal_profile:
    p_c_wealth: "declining ~0.05% per tick"
    total_biocapacity: "declining ~0.08% per tick"
    imperial_rent_pool: "exhibiting TRPF (declining rate of return)"
    death_timing: "tick 800-900 (Year 15-17)"

calorie_check:
  invariant: "base_subsistence > 0.0 in ALL scenarios"
  purpose: "Prevents Eden Mode - existence must have a cost"
  validation_code: |
    def create_scenario() -> tuple[WorldState, SimulationConfig, GameDefines]:
        defines = GameDefines()
        assert defines.economy.base_subsistence > 0.0, \
            "Eden Mode detected: base_subsistence must be > 0.0"
        return state, config, defines

objective_function:
  name: "objective_v2"
  components:
    - name: "Death Timing"
      weight: 0.4
      target: "Death around tick 850"
      formula: "1.0 - abs(death_tick - 850) / 400"
    - name: "Decay Shape"
      weight: 0.3
      target: "Smooth decline, not flatline or cliff"
    - name: "TRPF Manifestation"
      weight: 0.2
      target: "Rate of profit declines over time"
    - name: "Biocapacity Exhaustion"
      weight: 0.1
      target: "Near-zero around death tick"

anti_patterns:
  - name: "Zombie State (Flatline)"
    symptom: "Wealth graph is horizontal"
    cause: "base_subsistence = 0.0 or consumption_needs too low"
    detection: "std(wealth_timeseries) < 0.01"
    fix: "Increase consumption_needs, verify Calorie Check"

  - name: "Instant Death (Cliff)"
    symptom: "Simulation ends before tick 100"
    cause: "Extraction too aggressive, initial wealth too low"
    detection: "death_tick < 100"
    fix: "Reduce extraction_efficiency, increase initial wealth"

  - name: "Eternal Empire (Eden Mode)"
    symptom: "Survives 1040 ticks without significant decay"
    cause: "Extraction perfectly balanced with production"
    detection: "wealth[tick_1000] / wealth[tick_0] > 0.9"
    fix: "Enable biocapacity hysteresis, increase entropy_factor"

  - name: "Hollow Stability"
    symptom: "Metrics oscillate around stable point"
    cause: "System finds equilibrium (theoretically impossible)"
    detection: "mean(wealth[500:1000]) â‰ˆ mean(wealth[0:500])"
    fix: "Increase TRPF coefficient, add extraction hysteresis"

hyperband_pruning:
  - condition: "Flatline detected"
    threshold: "Any tick"
    action: "Prune (invalid)"
  - condition: "Death before tick 100"
    threshold: "tick < 100"
    action: "Prune (too aggressive)"
  - condition: "No decay by tick 500"
    threshold: "tick 500"
    action: "Prune (zombie/eden)"
  - condition: "Still alive at tick 1040"
    threshold: "tick 1040"
    action: "Flag for review"

parameter_ranges:
  entropy:
    - name: "economy.base_subsistence"
      range: [0.01, 0.05]
      purpose: "Calorie drain per tick"
      # Note: actual default is 0.0005, not in this range
    - name: "metabolism.entropy_factor"
      range: [1.1, 1.5]
      purpose: "Extraction inefficiency"
    - name: "metabolism.hysteresis_rate"
      range: [0.001, 0.01]
      purpose: "Permanent max_biocapacity damage"
      status: "NOT YET IMPLEMENTED"

  trpf:
    - name: "economy.trpf_coefficient"
      range: [0.0001, 0.001]
      purpose: "Rate of profit decay"
    - name: "economy.rent_pool_decay"
      range: [0.001, 0.005]
      purpose: "Background rent evaporation"

  recalibrated:
    - name: "extraction_efficiency"
      old_range: [0.1, 0.9]
      new_range: [0.3, 0.7]
      notes: "Narrower for stability"
    - name: "comprador_cut"
      old_range: [0.5, 1.0]
      new_range: [0.6, 0.9]
      notes: "Avoid extremes"

workflow:
  - step: 1
    name: "Verify Calorie Check"
    command: |
      poetry run python -c "
      from babylon.config.defines import GameDefines
      d = GameDefines()
      assert d.economy.base_subsistence > 0.0
      print('Calorie Check: PASSED')"

  - step: 2
    name: "Run 20-Year Audit"
    command: "mise run qa:audit --max-ticks 1040"

  - step: 3
    name: "Verify Decay Curve"
    command: "mise run sim:trace --ticks 1040"

  - step: 4
    name: "Check for Anti-Patterns"
    status: "PLANNED - tools/entropy_audit.py not yet implemented"

see_also:
  - "ai-docs/theory.yaml"
  - "ai-docs/balance-targets.yaml"
  - "ai-docs/metabolic-slice.yaml"
